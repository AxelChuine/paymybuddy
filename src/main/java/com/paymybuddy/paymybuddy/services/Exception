package com.paymybuddy.paymybuddy.services;

import com.paymybuddy.paymybuddy.models.Account;
import com.paymybuddy.paymybuddy.repository.IAccountRepository;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Objects;

@Service
public class AccountService {
    private final IAccountRepository repository;

    public AccountService(IAccountRepository repository) {
        this.repository = repository;
    }

    public List<Account> findAll() {
        List<Account> accounts = repository.findAll();
        if (Objects.isNull(accounts)) {
            throw new AccountNotFoundException();
        }
        return accounts;
    }

    public AccountDto createAccount(AccountDto account) {
      if (this.findAll().stream().anyMatch(a -> Objects.equals(account.firstName, a.firstName) && Objects.equals(account.lastName, a.lastName))) {
        throw new AccountAlreadyExistsException();
      }
      return this.mapper.toDto(this.repository.save(this.mapper.toModel(account)));
    }
}
